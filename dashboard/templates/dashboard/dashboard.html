{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Dashboard â€¢ Dynamic Dashboard AI{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'dashboard/css/dashboard.css' %}">
{% endblock %}

{% block content %}

<div id="dashboard-container">

    <!-- KPI SUMMARY CARDS -->
    <div class="kpi-container">
        <div class="kpi-card gold">
            <h3>Gold (Latest)</h3>
            <p id="kpi-gold">--</p>
            <span id="kpi-date">--</span>
        </div>

        <div class="kpi-card silver">
            <h3>Silver (Latest)</h3>
            <p id="kpi-silver">--</p>
            <span id="kpi-date-2">--</span>
        </div>

        <div class="kpi-card oil">
            <h3>Oil (Latest)</h3>
            <p id="kpi-oil">--</p>
            <span id="kpi-date-3">--</span>
        </div>
    </div>

    <!-- CHANGE DETECTION PANEL -->
    <div class="change-panel">
        <div class="change-card gold">
            <h4>Gold</h4>
            <p id="change-gold">--</p>
        </div>
        <div class="change-card silver">
            <h4>Silver</h4>
            <p id="change-silver">--</p>
        </div>
        <div class="change-card oil">
            <h4>Oil</h4>
            <p id="change-oil">--</p>
        </div>
    </div>

    <!-- BAR & PIE CHARTS SIDE BY SIDE -->
    <div class="charts-row">
        <!-- Bar Chart -->
        <div class="chart-card-container">
            <h2 class="section-title">Latest Price Comparison</h2>
            <div class="chart-card">
                <canvas id="bar-chart"></canvas>
            </div>
        </div>

        <!-- Pie Chart -->
        <div class="chart-card-container">
            <h2 class="section-title">Price Distribution (Latest)</h2>
            <div class="chart-card">
                <canvas id="pie-chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Live Dashboard Section -->
    <h2 class="page-title">Live Dynamic Dashboard</h2>
    <p class="subtitle">Visualize time-varying data and ask AI questions about trends.</p>

    <!-- STATS CARDS -->
    <section class="stats-grid">
        <div class="stat-card">
            <h4>Total Records</h4>
            <p id="total-records">{{ chart_data.dates|length }}</p>
        </div>
        <div class="stat-card">
            <h4>Last Updated</h4>
            <p id="last-updated">Just now</p>
        </div>
        <div class="stat-card">
            <h4>Charts Active</h4>
            <p id="charts-active">3</p>
        </div>
    </section>

    <!-- LINE CHARTS GRID -->
    <section class="charts">
        <div class="chart-box">
            <canvas id="chart-1"></canvas>
        </div>
        <div class="chart-box">
            <canvas id="chart-2"></canvas>
        </div>
        <div class="chart-box">
            <canvas id="chart-3"></canvas>
        </div>
    </section>

    <!-- SNAPSHOT BUTTON -->
    <div class="snapshot-action">
        <button id="saveSnapshotBtn">ðŸ“¸ Save Snapshot</button>
    </div>

    <form id="csrf-form">
        {% csrf_token %}
    </form>

    <!-- ASK AI PANEL -->
    <section id="ask-ai" class="ask-ai">
        <h3>Ask AI About This Dashboard</h3>
        <div class="ai-input-group">
            <input type="text" placeholder="Type your question here..." id="ai-question"/>
            <button id="ask-ai-btn">Ask</button>
        </div>
        <div id="ai-answer" class="ai-answer"></div>
    </section>

</div> <!-- END dashboard-container -->

<!-- Pass chart_data to JS -->
<script>
    const chartData = {{ chart_data|safe }};
</script>

<!-- Chart.js & html2canvas CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="{% static 'dashboard/js/chart_manager.js' %}"></script>
<script src="{% static 'dashboard/js/vlm_interface.js' %}"></script>

{% endblock %}
